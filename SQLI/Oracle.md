## 🧟‍♂️오라클 데이터베이스의 내장 프로시저 악용 SQLI

오라클 데이터베이스 환경에서 **SQL 인젝션**과 **DBMS_PIPE.RECEIVE_MESSAGE** 함수 (내장 프로시저)를 이용해 시스템 내부 정보를 얻으려는 시도


### 공격 쿼리 예시

```
https://test.com/board'||DBMS_PIPE.RECEIVE_MESSAGE(CHR(98)||CHR(98)||CHR(98),12)||'/11
```

* 공격이 실행된다면, 해당 SQL 쿼리는 `DBMS_PIPE.RECEIVE_MESSAGE`를 호출하면서 'bbb'라는 메시지를 읽으려고 시도하게 됩니다. 만약 해당 파이프에 메시지가 있다면 이를 반환받을 수 있습니다.
* 그러나 파이프에 메시지가 없다면 이 함수는 12초 동안 대기할 것이고, 이 대기 시간이 끝난 후 응답을 반환할 수 있습니다.

### 1. **`'||`** (SQL 문자열 결합)

* `||`는 SQL에서 **문자열 결합 연산자**입니다. 이 공격에서 문자열을 결합하여 SQL 쿼리를 변조하려는 의도가 있습니다.
* 즉, 원래의 SQL 쿼리 끝에 새로운 내용을 삽입하려는 목적입니다.

### 2. **`DBMS_PIPE.RECEIVE_MESSAGE`** 함수

* `DBMS_PIPE.RECEIVE_MESSAGE`는 **오라클 데이터베이스에서 제공하는 내장 프로시저**로, 특정 메시지를 기다리는 데 사용됩니다.
* 이 함수는 **파이프(pipe)**를 통해 특정 데이터를 읽을 수 있습니다. 이 공격에서는 `DBMS_PIPE.RECEIVE_MESSAGE`를 이용하여 서버의 동작을 제어하려고 시도하는 것입니다.

### 3. **`CHR(98)||CHR(98)||CHR(98)`**

* `CHR()` 함수는 ASCII 값을 입력받아 해당 문자로 변환하는 함수입니다.

  * `CHR(98)` → 문자 'b'
  * 이 부분은 'bbb'라는 문자열을 생성합니다.
* 즉, `CHR(98)||CHR(98)||CHR(98)`는 'bbb'라는 문자열을 생성하여, 그 값을 `DBMS_PIPE.RECEIVE_MESSAGE` 함수에 전달하려고 합니다.

### 4. **`12`**

* `12`는 `DBMS_PIPE.RECEIVE_MESSAGE` 함수에 전달되는 파라미터입니다. 이는 메시지를 받을 최대 대기 시간을 의미할 수 있습니다.

  * 오라클에서 이 값은 **메시지를 대기할 시간(초)**을 나타내며, 12초 동안 메시지를 기다리라는 의미일 수 있습니다.

### 5. **`'/11`**

* 이 부분은 SQL 쿼리 결과에 추가적으로 `/11`을 결합하려는 시도로 보입니다. 실제로 결과가 어떻게 이어질지는 쿼리의 맥락에 따라 다를 수 있습니다.

---

## ✅ 공격 의도

* 이 공격은 **오라클 데이터베이스에서 DBMS_PIPE 기능을 이용하여 원격 명령 실행** 또는 **서버에서 특정 메시지 읽기** 등을 시도하는 것입니다.
* 공격자는 `DBMS_PIPE.RECEIVE_MESSAGE`를 이용해 시스템 내부 메시지나 **서버 내부 상태 정보**를 노출시킬 수 있습니다.
* `bbb`라는 문자열을 전달한 이유는 공격자가 특정 파이프에 대해 'bbb'라는 데이터를 읽고자 하는 목적일 수 있습니다.
  

## ❗ 유효성 여부

1. **오라클 DBMS 사용 여부**

   * 이 공격은 **오라클 데이터베이스**에서만 유효합니다. 따라서, 공격이 **오라클 DBMS를 사용하고 있는 시스템**에만 유효합니다.
   * 다른 DBMS(MySQL, PostgreSQL 등)에서는 동작하지 않습니다.

2. **SQL 인젝션 취약점**

   * 공격이 **SQL 인젝션**을 통해 실행되려면 해당 웹 애플리케이션의 **입력 값 검증이 취약**해야 합니다. 즉, URL 파라미터 값이나 폼 데이터가 SQL 쿼리에 적절히 이스케이프되지 않으면 이런 공격이 성공할 수 있습니다.
   * SQL 인젝션을 방어하려면 사용자 입력에 대해 **파라미터화된 쿼리(prepared statement)** 또는 **ORM(Object-Relational Mapping)**을 사용해야 합니다.

3. **DBMS_PIPE 권한**

   * `DBMS_PIPE.RECEIVE_MESSAGE`는 오라클의 **내장 프로시저**이기 때문에 해당 기능을 사용할 수 있는 권한이 있어야 합니다. 대부분의 시스템에서는 이 기능이 **제한**되어 있거나, 공격자가 이를 사용할 권한을 갖고 있지 않을 수 있습니다.

