헤더를 이용한 웹 공격 기법은 다양합니다. 웹 서버와 애플리케이션이 헤더 값을 신뢰하고 이를 처리하는 과정에서 취약점이 발생할 수 있습니다. 아래는 **헤더 조작**을 통한 주요 공격 기법들과 그에 대한 **페이로드 예시**를 설명한 것입니다.

---

### 1. **X-Forwarded-For 헤더를 이용한 IP 스푸핑 (IP Spoofing)**

`X-Forwarded-For` 헤더는 주로 프록시 서버나 로드 밸런서 뒤에서 원래 클라이언트 IP를 확인하는 데 사용됩니다. 공격자는 이 값을 조작하여 자신의 IP 주소를 변경하거나 우회할 수 있습니다.

#### 공격 기법:

* 공격자는 `X-Forwarded-For` 헤더를 통해 자신의 요청을 신뢰할 수 있는 IP 주소에서 온 것처럼 보이게 합니다. 이를 통해 IP 기반 접근 제어나 블랙리스트 IP 우회를 시도할 수 있습니다.

#### 페이로드 예시:

```http
GET /admin HTTP/1.1
Host: victim.com
X-Forwarded-For: 127.0.0.1
```

* 서버가 `127.0.0.1`이면 로컬로 착각해 관리자 권한을 허용할 수도 있음.
* **정상적인 요청**: 서버가 클라이언트의 실제 IP를 확인하려면 로드 밸런서나 프록시에서 보낸 `X-Forwarded-For` 헤더 값을 신뢰할 수 있습니다. 공격자는 이를 악용하여 다른 IP 주소를 삽입합니다. 서버가 IP로 차단하거나, 특정 IP만 관리자 접근 가능할 때 악용 가능합니다.


### 1.1🛡️ `X-*` 헤더 계열 (비표준 헤더)

---

### 🔸 `X-Real-IP`

`X-Forwarded-For`와 거의 동일하지만, 프록시에서 더 명확하게 한 IP만 설정할 때 사용.

```http
X-Real-IP: 127.0.0.1
```

---

### 🔸 `X-HTTP-Method-Override`

#### ✅ 용도

클라이언트가 `POST`만 가능할 때 `PUT`, `DELETE` 등의 메서드로 동작을 바꾸는 데 사용됨.

#### 🔥 공격 기법: 메서드 우회

```http
POST /resource HTTP/1.1
Host: victim.com
X-HTTP-Method-Override: DELETE
```

서버가 이 헤더를 존중한다면 실제로는 `DELETE /resource`로 동작함.

---

### 🔸 `X-Original-URL` / `X-Rewrite-URL`

#### ✅ 용도

웹서버 리버스 프록시나 URL 리라이터가 원래 요청된 경로를 전달할 때 사용.

#### 🔥 공격 기법: 우회

```http
GET / HTTP/1.1
Host: victim.com
X-Original-URL: /admin
```

서버가 이 헤더를 기반으로 URL을 재해석하면, `/admin` 페이지에 접근하는 효과.

---

### 🔸 `X-Host` / `X-Forwarded-Host`

#### 🔥 호스트 헤더 공격

```http
GET / HTTP/1.1
Host: attacker.com
X-Forwarded-Host: victim.com
```

> 서버가 `Host`를 제대로 검증하지 않으면 SSRF나 비밀번호 재설정 링크 위조 등으로 이어질 수 있음.

---


### 2. **Host 헤더를 이용한 호스트 헤더 인젝션 (Host Header Injection)**

`Host` 헤더는 HTTP 요청에서 클라이언트가 요청한 서버의 도메인 이름을 나타냅니다. 일부 애플리케이션은 `Host` 헤더 값을 사용하여 서버의 동작을 결정하는데, 이 값이 신뢰되지 않으면 **호스트 헤더 인젝션** 공격이 발생할 수 있습니다.

#### 공격 기법:

* 공격자는 `Host` 헤더를 변조하여 서버의 동작을 조작하거나, 서버의 리디렉션을 악용하여 피해를 입힐 수 있습니다.
* 예를 들어, 취약한 웹 애플리케이션이 `Host` 헤더를 그대로 사용하여 이메일 발송을 한다면, 공격자가 이를 악용해 잘못된 이메일을 보내게 할 수 있습니다.

#### 페이로드 예시:

```http
Host: victim.com
X-Forwarded-Host: attacker.com
```

* `X-Forwarded-Host` 헤더를 악용하여, `victim.com`을 `attacker.com`으로 바꿀 수 있습니다.

---

### 3. **XSS (Cross-Site Scripting) 공격을 위한 `Referer` 헤더 악용**

`Referer` 헤더는 현재 요청이 어디서 왔는지, 즉 이전 페이지에 대한 정보를 담고 있습니다. 이를 통해 공격자는 `Referer` 헤더에 악성 스크립트를 삽입하여 **Cross-Site Scripting** (XSS) 공격을 시도할 수 있습니다.

#### 공격 기법:

* 공격자는 `Referer` 헤더를 조작하여 악성 스크립트를 삽입하고, 서버나 애플리케이션이 이 값을 출력할 때 이를 실행시킬 수 있습니다.

#### 페이로드 예시:

```http
Referer: <script>alert('XSS Attack!');</script>
```

* `Referer` 헤더에 삽입된 스크립트가 웹 애플리케이션에서 그대로 출력될 경우 XSS 공격이 발생합니다.

### 4. **Authorization 헤더를 이용한 인증 우회 (Authentication Bypass)**

`Authorization` 헤더는 사용자의 인증 정보를 포함하는 헤더입니다. 만약 웹 서버가 이 헤더를 처리할 때 취약점이 있다면, 공격자는 이를 조작하여 인증을 우회할 수 있습니다.

#### 공격 기법:

* 공격자는 `Authorization` 헤더에 잘못된 값을 넣어 인증을 우회하거나 권한이 없는 페이지에 접근할 수 있습니다.
* 또한, 브루트 포스 공격을 통해 `Authorization` 헤더를 여러 번 시도하여 인증을 우회할 수도 있습니다.

#### 페이로드 예시:

```http
Authorization: Basic YWRtaW46YWRtaW4=
```

* `Basic YWRtaW46YWRtaW4=`는 Base64로 인코딩된 `admin:admin`입니다. 이를 통해 공격자는 관리자 권한을 획득할 수 있습니다.

### 5. **User-Agent 헤더를 이용한 서버 측 응답 제어**

`User-Agent` 헤더는 클라이언트가 사용하는 브라우저나 장치의 종류를 나타냅니다. 이를 악용하면 서버의 동작을 변경하거나, 취약한 서버에서 버전 정보 등을 유출할 수 있습니다.

#### 공격 기법:

* 공격자는 `User-Agent` 헤더를 변경하여 서버에서 특정 취약한 동작을 유발하거나, 서버의 버전 정보를 확인하여 이를 기반으로 공격을 시도할 수 있습니다.

#### 페이로드 예시:

```http
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/58.0.3029.110 Safari/537.36
```

* 서버가 `User-Agent` 값에 따라 응답을 다르게 한다면, 공격자는 이를 악용하여 예기치 않은 동작을 유발할 수 있습니다.

---

### 6. **X-Content-Type-Options 헤더 우회**

`X-Content-Type-Options` 헤더는 MIME 타입 스니핑 공격을 방지하는 데 사용됩니다. 만약 이 헤더가 없거나 값이 잘못 설정되어 있다면, 공격자는 파일 업로드 취약점을 통해 악성 파일을 업로드할 수 있습니다.

#### 공격 기법:

* 서버에서 `X-Content-Type-Options` 헤더를 설정하지 않거나 `nosniff` 옵션이 없으면, 공격자는 악성 파일을 서버에 업로드한 후 이를 실행할 수 있습니다.

#### 페이로드 예시:

```http
X-Content-Type-Options: nosniff
```

* 만약 이 헤더가 설정되지 않은 경우, 공격자는 `application/javascript`로 파일을 업로드하고 실행시킬 수 있습니다.

### 7. **Cache-Control 헤더를 이용한 캐시 오염 공격**

`Cache-Control` 헤더는 HTTP 응답을 캐싱하는 방식을 정의합니다. 잘못된 설정이 있을 경우, 공격자는 캐시를 오염시켜 악성 콘텐츠가 클라이언트에게 전달되게 만들 수 있습니다.

#### 공격 기법:

* 서버에서 민감한 정보를 캐시할 때 적절한 헤더 설정이 없으면, 공격자는 이를 악용하여 해당 정보를 다른 사용자에게 전달할 수 있습니다.

#### 페이로드 예시:

```http
Cache-Control: no-store
```

* 이 헤더를 설정하면 캐시된 민감한 정보가 클라이언트 측에 남지 않게 되어, 정보 유출을 방지할 수 있습니다.

---

### 결론

헤더를 악용한 웹 공격 기법은 매우 다양하며, 서버가 헤더 값을 신뢰하거나 제대로 검증하지 않으면 공격자가 이를 악용할 수 있습니다. 따라서 서버에서 들어오는 모든 헤더 값을 **검증**하고, 민감한 데이터를 처리할 때 적절한 **보안 헤더 설정**을 하는 것이 중요합니다.
