β‘  query: s=captcha
μ…λ ¥κ°’ κ²€μ¦μ΄ μ—†κ³ , μ‚¬μ©μκ°€ s νλΌλ―Έν„°μ— μ„μμ κ°’μ„ λ„£μ„ μ μλ‹¤λ©΄ LFI λ“±μ΄ λ°μƒν•  μ μλ‹¤.



---
β‘΅ 
tag/index=&tag=%7Bpbohome/Indexot:if(1)(usort/*%3e*/(post/*%3e*/(/*%3e*/1),create_function/*%3e*/(/*%3e*/post/*%3e*/(/*%3e*/2),post/*%3e*/(/*%3e*/3))));//)%7D(123)%7B/pbhome/Indexoot:if%7D&tagstpl=news.html&lnoc2tspfar1_ue

## π§¨ μ›λ³Έ URL νλΌλ―Έν„° (μ¶•μ•½ μ •λ¦¬)

```txt
tag/index=&tag={
  pbohome/Indexot:if(1)(
    usort(
      post(1),
      create_function(
        post(2),
        post(3)
      )
    )
  );
}(123){/pbhome/Indexoot:if}&tagstpl=news.html&lnoc2tspfar1_ue
```

(β€» `%7B`, `%7D` β†’ `{`, `}`,
`/*%3e*/` β†’ `/*>*/` λ΅ λ³€ν•ν•΄ λ‚λ…ν™”λ μƒνƒ)

---

## π•µοΈβ€β™‚οΈ μ΄κ±΄ μ–΄λ–¤ κ³µκ²©μΈκ°€?

### π› οΈ κ³µκ²© κΈ°λ²•: **PHP Code Injection / Remote Code Execution**

μ΄ λ¬Έμμ—΄μ€ PHP μ½”λ“μ—μ„ ν”ν μ‚¬μ©λλ” κµ¬μ΅°μΈ `create_function`κ³Ό `usort()` λ“±μ„ μ΄μ©ν•΄,
**λ™μ μΌλ΅ μ½”λ“ μ‹¤ν–‰μ„ μ‹λ„ν•λ” ν•νƒ**μ…λ‹λ‹¤.

---

## π“ μ£Όμ” μ”μ† λ¶„μ„

### 1. **`create_function` μ‚¬μ©**

```php
create_function(post(2), post(3))
```

* μ΄λ” PHPμ μ¤λλ ν•¨μλ΅, λ¬Έμμ—΄ ν•νƒμ μ½”λ“λ¥Ό ν•¨μλ΅ μƒμ„±ν•  μ μμ.
* PHP 7.2 μ΄ν›„ μ κ±°λμ—μ§€λ§, **κµ¬λ²„μ „μ—μ„λ” μΉλ…μ μΈ RCE μλ‹¨**μΌλ΅ μ“°μ„.

### 2. **`usort(post(1), ..., ...)`**

* `usort()`μ€ λ°°μ—΄ μ •λ ¬ ν•¨μμΈλ°, μ½λ°± ν•¨μμ— **μ„μ μ½”λ“ μ‹¤ν–‰μ„ μ λ„**ν•  μ μμ.
* `post(n)` κµ¬μ΅°λ” κ³µκ²©μκ°€ μμ‹ μ΄ μ›ν•λ” λ°μ΄ν„°λ¥Ό POSTλ΅ λ„κΈ°κ² λ‹¤λ” μλ―ΈμΌ μ μμ.

### 3. **λ‚λ…ν™” (`/*%3e*/`, μ¤‘μ²© κ΄„νΈ, `tag=` νλΌλ―Έν„° ν™μ© λ“±)**

* ν•„ν„° μ°νλ¥Ό μ„ν•΄ μΌλ¶€ λ¬Έμλ“¤μ„ μ£Όμ„ μ²λ¦¬ν•κ±°λ‚ μΈμ½”λ”©
* μ: WAFκ°€ `create_function`μ„ λ§‰λ”λΌλ„ `cre/*>*/ate_function`μ²λΌ μΌκ°λ©΄ μ°ν κ°€λ¥

---

## π“ λ©μ μ€?

μ΄ νμ΄λ΅λ“μ λ©μ μ€:

> π”¥ μ„λ²„κ°€ μ΄ μ…λ ¥κ°’μ„ **eval, include, unserialize, preg\_replace** λ“±μΌλ΅ μ‹¤ν–‰ν•κ² λ§λ“¤μ–΄μ„
> **μ„μ μ½”λ“ μ‹¤ν–‰** β†’ **μ›Ήμ‰ μ‚½μ…** β†’ **μ‹μ¤ν… μ¥μ•…**

---

## π”΄ κ²°λ΅ : **κ³µκ²© μ‹λ„μ„ (κ³ μ„ν—)**

μ΄κ±΄ **κ³ λ„λ΅ λ‚λ…ν™”λ μ½”λ“ μΈμ μ…** μ‹λ„λ΅,
**PHP κµ¬λ²„μ „ κΈ°λ°μ μ·¨μ•½ μ›Ήμ‚¬μ΄νΈ**λ¥Ό νƒ€κ²μΌλ΅ λ§λ“¤μ–΄μ§„ κ³µκ²© νμ΄λ΅λ“μ…λ‹λ‹¤.

---

## β… λ€μ‘ λ°©μ•

| ν•­λ©           | μ΅°μΉ                                                                          |
| ------------ | --------------------------------------------------------------------------- |
| μ„λ²„ μ½”λ“ ν™•μΈ     | μ΄ `tag` νλΌλ―Έν„°λ‚ `create_function`, `usort`κ°€ μ‚¬μ©μ μ…λ ¥μΌλ΅ μ‹¤ν–‰λλ”μ§€ ν™•μΈ                 |
| PHP λ²„μ „ μ—…κ·Έλ μ΄λ“ | `create_function`μ€ PHP 7.2λ¶€ν„° μ κ±°λ¨ β€” μµμ‹  PHPλ΅ ν•„μ μ—…κ·Έλ μ΄λ“                         |
| μ…λ ¥ ν•„ν„°λ§       | `tag`, `tagstpl` κ°™μ€ νλΌλ―Έν„°μ—μ„ `{}`, `(`, `)`, `;`, `create_function` λ“±μ λ¬Έμμ—΄ μ°¨λ‹¨ |
| WAF λ£° μ„¤μ •     | ν•΄λ‹Ή λ¬Έμμ—΄ ν¨ν„΄ νƒμ§€/μ°¨λ‹¨ν•λ” λ£° μ¶”κ°€ (λλ” ModSecurity μ‚¬μ©)                                  |
| λ΅κ·Έ ν™•μΈ        | μ΄ μ”μ²­μ„ λ³΄λ‚Έ IP λ° μ μ‚¬ μ”μ²­μ λΉλ„ νμ•… β†’ IP μ°¨λ‹¨ λλ” κ²½κ³  μ„¤μ •                                 |

---

μΆ‹μµλ‹λ‹¤. μ§€κΈ λ³΄μ—¬μ£Όμ‹  λ‚΄μ©μ€ **WAF(Web Application Firewall) λλ” IDS/IPS μ‹μ¤ν…μ νƒμ§€ λ£° μ •μ**λ΅ λ³΄μ΄λ©°, λ‘ κ°€μ§€ PHP κ΄€λ ¨ κ³µκ²© μ‹λ„λ¥Ό κ°μ§€ν•κΈ° μ„ν• κ²ƒμ…λ‹λ‹¤.

---

## π“ λ£° μ”μ•½

| λ£° ID      | μ΄λ¦„                                                               | νƒμ§€ λ€μƒ                                  | νƒμ§€ λ‚΄μ©   |
| --------- | ---------------------------------------------------------------- | -------------------------------------- | ------- |
| `3000154` | CMD Injection Attack Detected (Common PHP Function Detected) v.1 | `ARGS_NAMES:<?php echo md5("cmd"); ?>` | `md5(`  |
| `969151`  | PHP Injection Attack (Opening Tag) v.1                           | `ARGS_NAMES:<?php echo md5("cmd"); ?>` | `<?php` |

---

## π” μ„Έλ¶€ λ¶„μ„

### π› οΈ 1. `rule: 3000154`

#### μ΄λ¦„:

**CMD Injection Attack Detected (Common PHP Function Detected) v.1**

#### λ©μ :

* PHP μ½”λ“ μ¤‘ **λ…λ Ήμ–΄ μ‹¤ν–‰ λλ” λ¬Έμμ—΄ μ΅°μ‘**μ— μμ£Ό μ“°μ΄λ” ν•¨μ κ°μ§€
* νΉν `md5(` κ°™μ€ ν•¨μλ” **μ°ν μ²΄ν¬λ‚ ν•΄μ‹ μ΅°μ‘μ— μ‚¬μ©λλ” ν”ν• ν¨ν„΄**

#### νƒμ§€ κΈ°μ¤€:

* \*\*νλΌλ―Έν„° μ΄λ¦„ (`ARGS_NAMES`)\*\*μ΄ μ΄ κ°’μ„ ν¬ν•¨:

```php
<?php echo md5("cmd"); ?>
```

* μ΄ μ•μ— **`md5(`** κ°€ μλ” κ²½μ° νƒμ§€

> β‘οΈ μλ―Έ: κ³µκ²©μκ°€ **νλΌλ―Έν„° μ΄λ¦„μ— PHP μ½”λ“**λ¥Ό μ‹¬μ–΄μ„ μ„λ²„κ°€ μ΄λ¥Ό μ²λ¦¬ν•κ² λ§λ“¤λ ¤λ” μ‹λ„

---

### π› οΈ 2. `rule: 969151`

#### μ΄λ¦„:

**PHP Injection Attack (Opening Tag) v.1**

#### λ©μ :

* PHP μ½”λ“ μΈμ μ… νƒμ§€
* νΉν `<?php` νƒκ·Έλ” PHP μ½”λ“μ μ‹μ‘μ„ μλ―Έν•λ―€λ΅ **κ°€μ¥ λ…λ°±ν• μΈμ μ… μ‹κ·Έλ‹μ² μ¤‘ ν•λ‚**

#### νƒμ§€ κΈ°μ¤€:

* λ§μ°¬κ°€μ§€λ΅ `ARGS_NAMES`μ— `<?php echo md5("cmd"); ?>` κ°™μ€ μ…λ ¥μ΄ μκ³ 
* κ·Έ μ•μ— `<?php` κ°€ ν¬ν•¨λμ–΄ μλ‹¤λ©΄ νƒμ§€

---

## π¤” κ·Έλ°λ° μ™ `ARGS_NAMES`?

λ³΄ν†µ WAF λ£°μ—μ„λ”:

* `ARGS` β†’ **μ”μ²­ νλΌλ―Έν„°μ κ°’**
* `ARGS_NAMES` β†’ **μ”μ²­ νλΌλ―Έν„°μ μ΄λ¦„**

μ: μ΄ URLμ„ λ³΄μ„Έμ” π‘‡

```
/test.php?<?php echo md5("cmd"); ?>=value
```

μ—¬κΈ°μ„:

* νλΌλ―Έν„° μ΄λ¦„: `<?php echo md5("cmd"); ?>`
* νλΌλ―Έν„° κ°’: `value`

β οΈ μ΄λ° μ”μ²­μ€ **λ„κ°€ λ΄λ„ ν•΄ν‚Ή μ‹λ„**μ…λ‹λ‹¤.
μ™λƒν•λ©΄ νλΌλ―Έν„° "μ΄λ¦„"μ— PHP μ½”λ“λ¥Ό λ„£μ—κΈ° λ•λ¬Έμ…λ‹λ‹¤.
κ·Έλ¦¬κ³  μ„λ²„ μ½”λ“κ°€ μ΄ νλΌλ―Έν„° μ΄λ¦„μ„ κΈ°λ°μΌλ΅ μ–΄λ–¤ λ™μ‘μ„ ν•κ² λλ‹¤λ©΄,
**RCE(μ›κ²© μ½”λ“ μ‹¤ν–‰)** κ°€λ¥μ„±λ„ μƒκΉλ‹λ‹¤.

---

## π― ν•µμ‹¬ μ”μ•½

| ν•­λ©    | λ‚΄μ©                                               |
| ----- | ------------------------------------------------ |
| νƒμ§€ λ€μƒ | HTTP νλΌλ―Έν„° "μ΄λ¦„" (ARGS\_NAMES)                     |
| κ³µκ²© λ©μ  | PHP μ½”λ“ μΈμ μ… / λ…λ Ήμ–΄ μ‹¤ν–‰ ν•¨μ (`md5`, `<?php`) ν¬ν•¨       |
| μ„ν—λ„   | π”¥ λ§¤μ° λ†’μ β€“ μΈμ μ… λλ” RCE κ°€λ¥μ„±                        |
| μ°ν λ°©μ§€ | μ£Όμ„, μΈμ½”λ”© λ“± ν•„ν„° μ°ν λ°©μ‹λ„ μ¶”κ°€ λ£° ν•„μ”                      |
| λ€μ‘ λ°©μ• | λ£° μ‘λ™ ν™•μΈ, λ΅κ·Έ κ²½κ³ , IP μ°¨λ‹¨ λλ” CAPTCHA, μ‘λ‹µ μ§€μ—° λ“± λ³΄μ™„μ±… μ μ© |

---
β‘£ bodyμ— 
<?php 
$_POST/**/[,  
,base64_decode(  λ¬Έμμ—΄ ν¬ν•¨
**κ³µκ²© μ„±κ³µ μ—¬λ¶€λ‚ λ‚΄λ¶€ μ½”λ“ μ·¨μ•½μ„±**λ„ λ¶„μ„ν•΄λ“λ¦΄ μ μμ–΄μ”.
ν•„μ”ν•λ©΄ WAF λ£° μƒν”λ„ μ κ³µν•΄λ“λ¦΄κ²μ”.
